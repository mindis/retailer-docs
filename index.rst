**********************
Rangespan API
**********************

Versioning
==========

Last updated: 2013-10-08


API Endpoint
============

https://api.rangespan.com/v2/


Authentication
==============

Authentication to the API occurs via `HTTP Basic Auth <http://en.wikipedia.org/wiki/Basic_access_authentication>`_. Use your Rangespan account name for the username, and API key for the password. You must authenticate for all requests - failure to provide the correct credentials will result in a HTTP 401 response.

All API requests must be made over `HTTPS <http://en.wikipedia.org/wiki/HTTP_Secure>`_. Calls made over plain HTTP will be rejected with a HTTP 403 response.


Data Formats
============

.. _date_formatting:

Dates and times
---------------

Date and time related fields should be UTC and formatted as per `ISO-8601 <http://en.wikipedia.org/wiki/ISO_8601>`_, some common examples are shown below.

============== ==================== ====================
Representation Format               Example
============== ==================== ====================
 Date           YYYY-MM-DD           2013-02-28
 Date and time  YYYY-MM-DDTHH:MM:SS  2013-02-28T23:59:59
============== ==================== ====================

Encoding
---------

All data sent to and from the API must be encoded using `UTF-8 <http://en.wikipedia.org/wiki/UTF-8>`_ and have a content type of 'application/json'.

Responses
=========

Response Codes
--------------

The Rangespan API uses standard `HTTP response codes <http://en.wikipedia.org/wiki/List_of_HTTP_status_codes>`_ to communicate the success or failure of a request. Users of the API should check the response codes of all requests and handle failure cases appropriately. Some common response codes generated by the API are shown in the table below.

==== =======
Code Summary
==== =======
 200  OK - The request was successful
 400  Bad Request - The request parameters were not valid
 401  Unauthorized - The request authentication failed
 403  Forbidden - You are not authorised to access the specified resource
 404  Not Found - The requested resource does not exist
 405  Method Not Allowed - The request method (e.g. GET, POST, PUT) was not valid
 409  Conflict - The request could not be completed due to a conflict with the current state of the resource
 5xx  Failure due to an issue with the Rangespan system
==== =======

.. _pagination:

Pagination
----------

Due to the large amount of data which may be returned by some of the endpoints, results may be returned in pages containing up to 100 items. When this occurs, the response will include a *page* key indicating the current page number, and a *next* key giving the URL of the next page of results (the *next* key will not be present where there are no more results to be returned).

.. sourcecode:: json

   {
      "page": 1,
      "next": "https://api.rangespan.com/v2/catalog/?page=2",
      "data": [
         ...
      ]
   }

Errors
------

When a request results in certain client errors (e.g. 400, 405, 409), the response may provide additional information regarding the error. The *error* key will provide a high level description of the error, whilst the *reason* key will provide more detailed information on the error.

.. sourcecode:: json

   {
      "error": "OrderPlacementError",
      "reason": "Missing mandatory customer information ('postcode')"
   }


Catalog
=======

Get catalog data for a RIN
--------------------------

.. http:get:: /catalog/{rin}

   :param rin: The Rangespan identification number
   :statuscode 200: OK
   :statuscode 401: Unauthorized - The authentication credentials provided are not valid
   :statuscode 404: Not Found - The RIN does not exist in your selection

   Returns the catalog data for the specified RIN in your selection.

   The catalog data consists of three elements: identifiers, extended attributes and image information.

   Example Request

   .. sourcecode:: http

      $ curl https://api.rangespan.com/v2/catalog/R00007ZN1P \
         -X GET \
         -u demo-retailer:ba109d4e07ee490080ff361018dc872b

   Example Response

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Content-Type: application/json

      {
         "rin": "R00007ZN1P",
         "attributes": [
            {
                "name: "gtin",
                "value": "0650590152445",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "manufacturer",
                "value": "Lexar Media",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "manufacturer_part_number",
                "value": "LJDTT8GBASBEU",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "asin",
                "value": "B002E3EPU2",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "item_name",
                "value": "Lexar Media JumpDrive TwistTurn USB Flash Drive (Blue) - 8GB",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "memory_capacity",
                "value": "8192",
                "modified_date": "2012-08-13T09:53:12"
            },
            {
                "name: "memory_card_type",
                "value": "USB Flash Drive",
                "modified_date": "2012-08-13T09:53:12"
            }
         ],
         images: [
            {
                "url": "http://media.rangespan.com/image/R00007ZN1P",
                "height": "500",
                "width": "500",
                "modified_date": "2013-02-28T12:00:00"
            }
         ]
      }


Offers
==========

Get offer data for a RIN
------------------------

.. http:get:: /offers/{rin}

   :param rin: The Rangespan identification number
   :query date: Filter for offers from a specific date (note this should not include a time - see :ref:`date_formatting`).
   :statuscode 200: OK
   :statuscode 400: BadRequest - The date parameter was not formatted correctly
   :statuscode 401: Unauthorized - The authentication credentials provided are not valid
   :statuscode 404: Not Found - The RIN does not exist in your selection

   Returns the pricing information for the specified RIN.

   Example Request

   .. sourcecode:: http

      $ curl https://api.rangespan.com/v2/offers/R00007ZN1P?date=2013-02-28 \
         -X GET \
         -u demo-retailer:ba109d4e07ee490080ff361018dc872b

   Example Response

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Content-type: application/json
      {
         "rin": "R00007ZN1P",
         "unit_cost_ex_vat": "10.00",
         "unit_cost_inc_vat": "12.00",
         "vat_rate": "0.200"
         "vat_amount": "2.00",
         "inventory", "5",
         "valid_from": "2013-02-28T00:00:00",
         "valid_to": "2013-03-05T12:00:00"
      }



Orders
================

Place a new order
-----------------
.. http:post:: /orders/

   :statuscode 201: Created - The order was created successfully
   :statuscode 400: Bad Request - The request parameters or data are not valid
   :statuscode 401: Unauthorized - The authentication credentials provided are not valid
   :statuscode 405: Method Not Allowed - The HTTP method was incorrect
   :statuscode 409: Conflict - An order with this reference already exists

   Example request / response for successful order submission

   .. sourcecode:: http

      $ curl https://api.rangespan.com/v2/orders/ \
         -u demo-retailer:ba109d4e07ee490080ff361018dc872b \
         -X POST \
         -d '{
                "retailer_reference": "foobarbaz",
                "placed_date": "2013-02-28",
                "items": [
                   {
                      "rin": "R000000001",
                      "quantity": 2
                   },
                   {
                      "rin": "R000000002",
                      "quantity": 1
                   }
                ],
                "customer": {
                   "title": "Dr",
                   "name": "Phil Feelgood",
                   "address_line_1": "9 Cell Block",
                   "address_line_2": "Jetty Road",
                   "address_line_3": "",
                   "town": "Canvey Island",
                   "county": "Essex",
                   "country": "UK",
                   "postcode": "SS8 1LP",
                   "phone": "",
                   "mobile": "",
                   "email": "test@rangespan.com"
                }
             }'

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Content-type: application/json
      {
         "rangespan_reference": "12345",
         "retailer_reference": "foobarbaz",
         "placed_date": "2013-02-28",
         "promise_date": "2013-03-07",
         "created": "2013-02-28T13:59:59",
         "last_modified": "2013-02-28T13:59:59",
         "pending": [
            {
               "rin": "R000000001",
               "quantity": 2,
               "unit_cost_ex_vat": "12.34",
               "vat_rate": "0.2000"
            },
            {
               "rin": "R000000002",
               "quantity": 1,
               "unit_cost_ex_vat": "76.54",
               "vat_rate": "0.2000"
            }
         ],
         "processing": [],
         "shipped": [],
         "cancelled": [],
         "returned": [],
         "customer": {
            "title": "Dr",
            "name": "Phil Feelgood",
            "address_line_1": "9 Cell Block",
            "address_line_2": "Jetty Road",
            "address_line_3": "",
            "town": "Canvey Island",
            "county": "Essex",
            "country": "UK",
            "postcode": "SS8 1LP",
            "phone": "",
            "mobile": "",
            "email": "test@rangespan.com"
         }
      }

Get details for an order
------------------------
.. http:get:: /orders/{rangespan_reference}

   :param rangespan_reference: The Rangespan identifier for an order
   :statuscode 200: OK
   :statuscode 400: Bad Request - The request parameters are not valid
   :statuscode 401: Unauthorized - The authentication credentials provided are not valid
   :statuscode 404: Not Found - The specified rangespan_reference does not exist

   Returns order details for the specified rangespan_reference

   Example request

   .. sourcecode:: http

      $ curl https://api.rangespan.com/v2/orders/12345 \
         -X GET \
         -u demo-retailer:ba109d4e07ee490080ff361018dc872b

   Example response

   .. sourcecode:: http

      {
         "retailer": "demo-retailer",
         "rangespan_reference": "12345",
         "retailer_reference": "foobarbaz",
         "placed_date": "2013-02-28",
         "promise_date": "2013-03-07",
         "created": "2013-02-28T13:59:59",
         "last_modified": "2013-02-28T13:59:59",
         "pending": [
            {
               "rin": "R000000001",
               "quantity": 2,
               "unit_cost_ex_vat": "12.34",
               "vat_rate": "0.2000"
            }
         ],
         "processing": [],
         "shipped": [
            {
               "rin": "R000000002",
               "quantity": 1,
               "unit_cost_ex_vat": "76.54",
               "vat_rate": "0.2000",
               "shipments": [
                  {
                     "provider": "Royal Mail",
                     "reference": "AZ1234567890",
                     "dispatched_on": "2013-03-01T12:59:59"
                  }
               ]
           }
         ],
         "cancelled": [],
         "returned": [],
         "customer": {
            "title": "Dr",
            "name": "Phil Feelgood",
            "address_line_1": "9 Cell Block",
            "address_line_2": "Jetty Road",
            "address_line_3": "",
            "town": "Canvey Island",
            "county": "Essex",
            "country": "UK",
            "postcode": "SS8 1LP",
            "phone": "",
            "mobile": "",
            "email": "test@rangespan.com"
         }
      }


Cancel an order
---------------
.. http:post:: /orders/{rangespan_referece}

   :statuscode 200: OK
   :statuscode 400: Bad Request - The request parameters or data are not valid
   :statuscode 401: Unauthorized - The authentication credentials provided are not valid
   :statuscode 404: Not Found - The specified rangespan_reference does not exist
   :statuscode 409: Conflict - The order update was not possible to due a conflict

   Cancel an order (or part of an order) with given rangespan_reference.

   To cancel an order (or part of an order), you should adjust the item quantity to the desired amount (e.g. if the original order was for a quantity of 3 and you wish to cancel 1 unit then set the quantity to 2, or if you wish to cancel all units then set the quantity to 0).  It is only possible to cancel items which are currently *pending* - if you wish to cancel parts of an order which are *processing* then you will need to contact Rangespan support as the items may be in-flight with one of our vendors. You need only include the RINs that you wish to cancel in the request.

   Example request / response for order cancellation

   .. sourcecode:: http

      $ curl https://api.rangespan.com/v2/orders/12345 \
         -u demo-retailer:ba109d4e07ee490080ff361018dc872b \
         -X POST \
         -d '{
                "rangespan_reference": 12345,
                "retailer_reference": "foobarbaz",
                "placed_date": "2013-02-28",
                "items": [
                   {
                      "rin": "R000000001",
                      "quantity": 0
                   },
                   {
                      "rin": "R000000002",
                      "quantity": 0
                   }
                ],
                "customer": {
                   "title": "Dr",
                   "name": "Phil Feelgood",
                   "address_line_1": "9 Cell Block",
                   "address_line_2": "Jetty Road",
                   "address_line_3": "",
                   "town": "Canvey Island",
                   "county": "Essex",
                   "country": "UK",
                   "postcode": "SS8 1LP",
                   "phone": "",
                   "mobile": "",
                   "email": "test@rangespan.com"
                }
             }'

   .. sourcecode:: http

      HTTP/1.1 200 OK
      Content-Type: application/json
      {
         "retailer": "demo-retailer",
         "rangespan_reference": "12345",
         "retailer_reference": "foobarbaz",
         "placed_date": "2013-02-28",
         "promise_date": "2013-03-07",
         "created": "2013-02-28T13:59:59",
         "last_modified": "2013-03-01T10:14:59",
         "pending": [],
         "processing": [],
         "shipped": [],
         "cancelled": [
            {
               "rin": "R000000001",
               "quantity": 2,
               "unit_cost_ex_vat": "12.34",
               "vat_rate": "0.2000"
            },
            {
               "rin": "R000000002",
               "quantity": 1,
               "unit_cost_ex_vat": "76.54",
               "vat_rate": "0.2000"
            }
         ],
         "returned": [],
         "customer": {
            "title": "Dr",
            "name": "Phil Feelgood",
            "address_line_1": "9 Cell Block",
            "address_line_2": "Jetty Road",
            "address_line_3": "",
            "town": "Canvey Island",
            "county": "Essex",
            "country": "UK",
            "postcode": "SS8 1LP",
            "phone": "",
            "mobile": "",
            "email": "test@rangespan.com"
         }
      }
